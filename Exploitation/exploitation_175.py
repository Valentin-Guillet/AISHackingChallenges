
import string


valid_chars = string.ascii_uppercase + string.ascii_lowercase + string.digits + "+/"
base64_chars = {i: char for i, char in enumerate(valid_chars)}

msg_type = 0x45
msg = "ABCD"
# msg_len = len(msg)
msg_len = 0x2fff

target = []
target += [msg_type & 0xff, msg_type >> 8]
target += [msg_len & 0xff, msg_len >> 8]
target += [ord(c) for c in msg]


# target = [0x39, 0x05]
nb_pad = (3 - len(target)) % 3
target += [0x00] * nb_pad

encoded_msg = ""
for i in range(0, len(target), 3):
    chars = []
    chars.append(target[i] >> 2)
    chars.append(((target[i] & 0b11) << 4) | (target[i + 1] >> 4))
    chars.append(((target[i + 1] & 0b1111) << 2) | target[i + 2] >> 6)
    chars.append(target[i + 2] & 0b111111)
    encoded_msg += "".join(map(base64_chars.get, chars))

if nb_pad:
    encoded_msg = encoded_msg[:-nb_pad] + "=" * nb_pad

print(encoded_msg)
